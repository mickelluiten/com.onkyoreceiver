<!doctype html>
<html>
    <head>

        <!-- The '/homey.js' script must be included in your settings view to work -->
        <script type="text/javascript" src="/homey.js" data-origin="settings"></script>

    </head>
    <body>

        <h1 data-i18n="settings.title">
            <!--
            This field will automatically be filled by a translated string with key 'settings.title'.
            Read more about translations at Internationalization.
            -->
        </h1>
        <p data-i18n="settings.intro">
            <!--
            This field will also be translated
            -->
        </p>

        <fieldset>
            
            <div class="field row">
                <label for="ipAddressSet">IP Address</label>
                <input id="ipAddressSet" pattern="^(([01]?\\d\\d?|2[0-4]\\d|25[0-5]).){3}([01]?\\d\\d?|2[0-4]\\d|25[0-5])$" type="text" value="" />
            </div>
            <div class="field row">
                <label for="maxVolumeSet">Maximum Volume</label>
                <input id="maxVolumeSet" type="text" value="" />
            </div>
            <div class="field row">
                <label for="volumeStepSet">VolumeStep</label>
                <input id="volumeStepSet" type="text" value="" />
            </div>

        </fieldset>

        <button id="save" class="right">Save changes</button>

        <script type="text/javascript">

        // a method named 'onHomeyReady' must be present in your code
        function onHomeyReady( Homey ){

          Homey.get('ipAddressSet', function( err, ipAddressSet ) {
               if( err ) return Homey.alert( err );
               Homey.set('ipAddressSet', '0.0.0.0');
               ipAddressSetElement.value = ipAddressSet;
              });

            Homey.get('maxVolumeSet', function( err, maxVolumeSet ) {
               if( err ) return Homey.alert( err );
               Homey.set('maxVolumeSet', '50');
               maxVolumeSetElement.value = maxVolumeSet;
            });

            Homey.get('volumeStepSet', function( err, volumeStepSet ) {
               if( err ) return Homey.alert( err );
               Homey.set('volumeStepSet', '2');
               volumeStepSetElement.value = volumeStepSet;
            });


            // Tell Homey we're ready to be displayed
            Homey.ready();

            var ipAddressSetElement = document.getElementById('ipAddressSet');
            var maxVolumeSetElement = document.getElementById('maxVolumeSet');
            var volumeStepSetElement = document.getElementById('volumeStepSet');
            var saveElement = document.getElementById('save');

            saveElement.addEventListener('click', function(e) {

                Homey.set('ipAddressSet', ipAddressSetElement.value, function( err ){
                    if( err ) return Homey.alert( err );
                });
                Homey.set('maxVolumeSet', maxVolumeSetElement.value, function( err ){
                    if( err ) return Homey.alert( err );
                });
                Homey.set('volumeStepSet', volumeStepSetElement.value, function( err ){
                    if( err ) return Homey.alert( err );
                });

                document.getElementById('save').innerHTML = "Settings saved";

            });
        }
        </script>

    </body>
</html>

